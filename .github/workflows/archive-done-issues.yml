name: Archive Done Issues

on:
  schedule:
    - cron: '0 0 * * 0'  # 매주 일요일 자정에 실행
  workflow_dispatch:  

jobs:
  archive_done_issues:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install GitHub CLI via Chocolatey
        run: choco install gh -y

      - name: Archive issues labeled as Done
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh auth login --with-token <<< %GITHUB_TOKEN%
          
          for /F "usebackq tokens=*" %%i in (`gh issue list --state closed --label "Done" --json number --jq ".[].number"`) do (
              echo Archiving issue #%%i
              gh issue edit %%i --add-label archived --remove-label "Done"
          )
